{% extends 'base.html' %}
{% load static %}

{% block content %}

<!-- PAGE WRAPPER -->
<section class="bg-slate-50/60">
  <div class="container mx-auto px-4 py-10">

    <!-- HERO / HEADER -->
    <div class="relative overflow-hidden rounded-3xl border border-slate-200 bg-white shadow-[0_18px_60px_rgba(15,23,42,0.08)]">
      <!-- subtle gradient -->
      <div class="absolute inset-0 bg-gradient-to-br from-blue-50 via-white to-slate-50 pointer-events-none"></div>

      <div class="relative p-6 md:p-10">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6">
          <div>
            <div class="inline-flex items-center gap-2 rounded-full border border-blue-100 bg-blue-50 px-3 py-1 text-xs font-semibold text-blue-700">
              <i class="fas fa-brain"></i>
              Skill Assessments
            </div>
            <h1 class="mt-4 text-2xl md:text-4xl font-extrabold tracking-tight text-slate-900">
              Skill Assessment Quizzes
            </h1>
            <p class="mt-3 text-slate-600 max-w-2xl">
              Test your knowledge, track progress, and unlock personalized job recommendations based on your performance.
            </p>

            <div class="mt-5 flex flex-wrap gap-2 text-xs">
              <span class="inline-flex items-center gap-2 rounded-full bg-slate-100 px-3 py-1 text-slate-700">
                <i class="fas fa-bolt text-slate-500"></i> Quick & focused
              </span>
              <span class="inline-flex items-center gap-2 rounded-full bg-slate-100 px-3 py-1 text-slate-700">
                <i class="fas fa-shield-alt text-slate-500"></i> Verified skill signals
              </span>
              <span class="inline-flex items-center gap-2 rounded-full bg-slate-100 px-3 py-1 text-slate-700">
                <i class="fas fa-briefcase text-slate-500"></i> Career matching
              </span>
            </div>
          </div>

          <!-- Right side CTA -->
          <div class="flex flex-col sm:flex-row gap-3">
            {% if user.is_authenticated %}
              {# Optional: only show if you have a create URL. If you don't, remove this block or update URL. #}
              {% url 'app:create_quiz' as create_quiz_url %}
              {% if create_quiz_url %}
                <a href="{{ create_quiz_url }}"
                   class="inline-flex items-center justify-center gap-2 rounded-xl bg-slate-900 px-5 py-3 text-white font-semibold shadow hover:bg-slate-800 transition">
                  <i class="fas fa-plus"></i>
                  Create Quiz
                </a>
              {% endif %}
            {% endif %}
            <a href="{% url 'app:job_list' %}"
               class="inline-flex items-center justify-center gap-2 rounded-xl border border-slate-200 bg-white px-5 py-3 text-slate-800 font-semibold hover:bg-slate-50 transition">
              <i class="fas fa-briefcase"></i>
              Explore Jobs
            </a>
          </div>
        </div>

        <!-- SEARCH / FILTER BAR -->
        <div class="mt-8 rounded-2xl border border-slate-200 bg-white/70 backdrop-blur px-4 py-4 md:px-6">
          <form method="GET" class="grid grid-cols-1 md:grid-cols-12 gap-3 items-center">

            <!-- Search -->
            <div class="md:col-span-6 relative">
              <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
              <input
                type="text"
                name="q"
                value="{{ search_query }}"
                placeholder="Search quiz title, instructor, skill..."
                class="w-full rounded-xl border border-slate-200 bg-white pl-11 pr-4 py-3 text-sm
                       focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-400"
              />
            </div>

            <!-- Difficulty filter -->
            <div class="md:col-span-2">
              <select name="difficulty"
                      class="w-full rounded-xl border border-slate-200 bg-white px-3 py-3 text-sm
                             focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-400">
                <option value="">Difficulty</option>
                <option value="beginner" {% if request.GET.difficulty == "beginner" %}selected{% endif %}>Beginner</option>
                <option value="intermediate" {% if request.GET.difficulty == "intermediate" %}selected{% endif %}>Intermediate</option>
                <option value="advanced" {% if request.GET.difficulty == "advanced" %}selected{% endif %}>Advanced</option>
              </select>
            </div>

            <!-- Sort -->
            <div class="md:col-span-2">
              <select name="sort"
                      class="w-full rounded-xl border border-slate-200 bg-white px-3 py-3 text-sm
                             focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-400">
                <option value="">Sort</option>
                <option value="rating" {% if request.GET.sort == "rating" %}selected{% endif %}>Top rated</option>
                <option value="popular" {% if request.GET.sort == "popular" %}selected{% endif %}>Most attempts</option>
                <option value="short" {% if request.GET.sort == "short" %}selected{% endif %}>Shortest</option>
                <option value="long" {% if request.GET.sort == "long" %}selected{% endif %}>Longest</option>
              </select>
            </div>

            <!-- Submit -->
            <div class="md:col-span-2 flex gap-2">
              <button type="submit"
                      class="w-full inline-flex items-center justify-center gap-2 rounded-xl bg-blue-600 px-4 py-3 text-white font-semibold hover:bg-blue-700 transition">
                <i class="fas fa-filter"></i> Apply
              </button>

              {% if request.GET.q or request.GET.difficulty or request.GET.sort %}
                <a href="{% url 'app:quiz_list' %}"
                   class="inline-flex items-center justify-center rounded-xl border border-slate-200 bg-white px-4 py-3 text-slate-700 hover:bg-slate-50 transition">
                  <i class="fas fa-times"></i>
                </a>
              {% endif %}
            </div>

          </form>

          <!-- Small helper line -->
          <div class="mt-3 flex flex-wrap items-center justify-between gap-2 text-xs text-slate-500">
            <p class="flex items-center gap-2">
              <i class="fas fa-info-circle"></i>
              Tip: Take 2–3 quizzes to unlock better recommendations.
            </p>

            <div class="flex items-center gap-2">
              <span class="inline-flex items-center gap-2 rounded-full bg-slate-100 px-3 py-1">
                <i class="fas fa-clock"></i> Avg 10–20 min
              </span>
              <span class="inline-flex items-center gap-2 rounded-full bg-slate-100 px-3 py-1">
                <i class="fas fa-star"></i> Rated by users
              </span>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- QUIZ GRID -->
    <div class="mt-10 max-w-6xl mx-auto">
      <div class="flex items-end justify-between gap-4 mb-6">
        <div>
          <h2 class="text-lg md:text-xl font-bold text-slate-900">Available Quizzes</h2>
          <p class="text-sm text-slate-600">Pick one and start building your profile score.</p>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

        {% for quiz in quizzes %}
          <!-- Card -->
          <div class="group rounded-2xl border border-slate-200 bg-white shadow-sm hover:shadow-[0_18px_60px_rgba(15,23,42,0.10)] transition overflow-hidden">
            <!-- Top strip -->
            <div class="p-5 border-b border-slate-100 bg-gradient-to-b from-slate-50 to-white">

              <!-- Instructor + difficulty -->
              <div class="flex items-start justify-between gap-3">
                <div class="flex items-center gap-3 min-w-0">
                  <img
                    src="{% if quiz.instructor_photo %}{{ quiz.instructor_photo.url }}{% else %}https://via.placeholder.com/60x60?text={{ quiz.instructor|slice:':1' }}{% endif %}"
                    alt="{{ quiz.instructor }}"
                    class="w-11 h-11 rounded-xl object-cover border border-slate-200"
                  />
                  <div class="min-w-0">
                    <p class="text-xs text-slate-500">Instructor</p>
                    <p class="text-sm font-semibold text-slate-800 truncate">{{ quiz.instructor }}</p>
                  </div>
                </div>

                <span class="shrink-0 px-3 py-1 {{ quiz.get_difficulty_badge_class }} text-xs rounded-full font-semibold">
                  {{ quiz.get_difficulty_display }}
                </span>
              </div>

              <!-- Title -->
              <a href="{% url 'app:quiz_detail' quiz.id %}" class="block mt-4">
                <h3 class="text-base font-bold text-slate-900 leading-snug group-hover:underline">
                  {{ quiz.title }}
                </h3>
                <p class="mt-1 text-sm text-slate-600 line-clamp-2">
                  Build confidence with targeted questions and instant feedback.
                </p>
              </a>

              <!-- Rating -->
              <div class="mt-4 flex items-center justify-between">
                <div class="flex items-center">
                  <span class="text-sm font-semibold text-slate-900">{{ quiz.rating }}/5</span>
                  <div class="ml-2 flex items-center">
                    {% with filled_stars=quiz.get_star_rating.0 empty_stars=quiz.get_star_rating.1 %}
                      {% for i in "12345" %}
                        {% if forloop.counter <= filled_stars %}
                          <i class="fas fa-star text-yellow-400"></i>
                        {% else %}
                          <i class="fas fa-star text-slate-200"></i>
                        {% endif %}
                      {% endfor %}
                    {% endwith %}
                  </div>
                </div>

                <span class="text-xs text-slate-500 inline-flex items-center gap-2 rounded-full bg-slate-100 px-3 py-1">
                  <i class="fas fa-clock"></i>
                  {{ quiz.duration_minutes }} min
                </span>
              </div>

              <!-- Stats -->
              <div class="mt-4 grid grid-cols-3 gap-2 text-xs text-slate-600">
                <div class="rounded-xl bg-slate-50 border border-slate-100 p-3 text-center">
                  <p class="font-bold text-slate-900">{{ quiz.total_questions }}</p>
                  <p class="text-[11px] mt-1">Questions</p>
                </div>
                <div class="rounded-xl bg-slate-50 border border-slate-100 p-3 text-center">
                  <p class="font-bold text-slate-900">{{ quiz.attempts_count }}</p>
                  <p class="text-[11px] mt-1">Attempts</p>
                </div>
                <div class="rounded-xl bg-slate-50 border border-slate-100 p-3 text-center">
                  <p class="font-bold text-slate-900">AI</p>
                  <p class="text-[11px] mt-1">Matching</p>
                </div>
              </div>
            </div>

            <!-- Actions -->
            <div class="p-5">
              <div class="flex gap-2">

                {% if user.is_authenticated %}
                  <a href="{% url 'app:start_quiz' quiz.id %}"
                     class="flex-1 inline-flex items-center justify-center gap-2 rounded-xl bg-slate-900 px-4 py-3 text-white font-semibold hover:bg-slate-800 transition">
                    <i class="fas fa-play"></i>
                    Start
                  </a>
                {% else %}
                  <a href="{% url 'login' %}?next={% url 'app:quiz_detail' quiz.id %}"
                     class="flex-1 inline-flex items-center justify-center gap-2 rounded-xl bg-slate-900 px-4 py-3 text-white font-semibold hover:bg-slate-800 transition">
                    <i class="fas fa-lock"></i>
                    Login to Start
                  </a>
                {% endif %}

                <a href="{% url 'app:quiz_detail' quiz.id %}"
                   class="inline-flex items-center justify-center rounded-xl border border-slate-200 bg-white px-4 py-3 text-slate-800 hover:bg-slate-50 transition"
                   aria-label="View details">
                  <i class="fas fa-arrow-right"></i>
                </a>

                {% if user.is_authenticated %}
                  {# Optional edit button if you have an edit URL. Update to your actual URL name. #}
                  {% url 'app:edit_quiz' quiz.id as edit_quiz_url %}
                  {% if edit_quiz_url %}
                    <a href="{{ edit_quiz_url }}"
                       class="inline-flex items-center justify-center rounded-xl border border-slate-200 bg-white px-4 py-3 text-slate-800 hover:bg-slate-50 transition"
                       aria-label="Edit quiz">
                      <i class="fas fa-pen"></i>
                    </a>
                  {% endif %}
                {% endif %}

              </div>

              <!-- trust line -->
              <p class="mt-3 text-xs text-slate-500 flex items-center gap-2">
                <i class="fas fa-check-circle text-emerald-500"></i>
                Results are saved to your profile for better recommendations.
              </p>
            </div>
          </div>
        {% empty %}
          <!-- Empty State -->
          <div class="col-span-full">
            <div class="rounded-3xl border border-dashed border-slate-300 bg-white p-10 text-center">
              <div class="mx-auto w-16 h-16 rounded-2xl bg-slate-100 flex items-center justify-center mb-4">
                <i class="fas fa-clipboard-list text-2xl text-slate-500"></i>
              </div>
              <h3 class="text-xl font-bold text-slate-700">No quizzes available</h3>
              <p class="mt-2 text-slate-500">Check back later — new skill assessments are added regularly.</p>

              <div class="mt-6 flex flex-col sm:flex-row gap-3 justify-center">
                <a href="{% url 'app:job_list' %}"
                   class="inline-flex items-center justify-center gap-2 rounded-xl bg-blue-600 px-5 py-3 text-white font-semibold hover:bg-blue-700 transition">
                  <i class="fas fa-briefcase"></i> Browse Jobs
                </a>
                {% if user.is_authenticated %}
                  {% url 'app:create_quiz' as create_quiz_url %}
                  {% if create_quiz_url %}
                    <a href="{{ create_quiz_url }}"
                       class="inline-flex items-center justify-center gap-2 rounded-xl border border-slate-200 bg-white px-5 py-3 text-slate-800 font-semibold hover:bg-slate-50 transition">
                      <i class="fas fa-plus"></i> Create First Quiz
                    </a>
                  {% endif %}
                {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}

      </div>

      {# OPTIONAL: Pagination UI (only works if you pass page_obj) #}
      {% if page_obj %}
        <div class="mt-10 flex items-center justify-center gap-2">
          {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}"
               class="px-4 py-2 rounded-xl border border-slate-200 bg-white hover:bg-slate-50">Prev</a>
          {% endif %}
          <span class="px-4 py-2 rounded-xl bg-slate-900 text-white text-sm">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
          </span>
          {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}"
               class="px-4 py-2 rounded-xl border border-slate-200 bg-white hover:bg-slate-50">Next</a>
          {% endif %}
        </div>
      {% endif %}
    </div>

    <!-- WHY TAKE QUIZZES -->
    <div class="mt-16 max-w-6xl mx-auto">
      <div class="text-center">
        <h2 class="text-2xl md:text-3xl font-extrabold text-slate-900">Why take our quizzes?</h2>
        <p class="mt-3 text-slate-600 max-w-2xl mx-auto">
          Stronger signals → better job matches → faster growth.
        </p>
      </div>

      <div class="mt-10 grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Benefit Card -->
        <div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm hover:shadow-md transition">
          <div class="w-12 h-12 rounded-2xl bg-blue-50 flex items-center justify-center mb-4">
            <i class="fas fa-certificate text-xl text-blue-600"></i>
          </div>
          <h3 class="font-bold text-slate-900">Get Certified</h3>
          <p class="mt-2 text-sm text-slate-600">Show verified skills to recruiters with confidence.</p>
        </div>

        <div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm hover:shadow-md transition">
          <div class="w-12 h-12 rounded-2xl bg-emerald-50 flex items-center justify-center mb-4">
            <i class="fas fa-briefcase text-xl text-emerald-600"></i>
          </div>
          <h3 class="font-bold text-slate-900">Job Matching</h3>
          <p class="mt-2 text-sm text-slate-600">Personalized recommendations based on your performance.</p>
        </div>

        <div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm hover:shadow-md transition">
          <div class="w-12 h-12 rounded-2xl bg-purple-50 flex items-center justify-center mb-4">
            <i class="fas fa-chart-line text-xl text-purple-600"></i>
          </div>
          <h3 class="font-bold text-slate-900">Skill Tracking</h3>
          <p class="mt-2 text-sm text-slate-600">Measure progress and target weak areas quickly.</p>
        </div>

        <div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm hover:shadow-md transition">
          <div class="w-12 h-12 rounded-2xl bg-orange-50 flex items-center justify-center mb-4">
            <i class="fas fa-clock text-xl text-orange-600"></i>
          </div>
          <h3 class="font-bold text-slate-900">Time Efficient</h3>
          <p class="mt-2 text-sm text-slate-600">Quick assessments that fit into your schedule.</p>
        </div>

        <div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm hover:shadow-md transition">
          <div class="w-12 h-12 rounded-2xl bg-rose-50 flex items-center justify-center mb-4">
            <i class="fas fa-user-tie text-xl text-rose-600"></i>
          </div>
          <h3 class="font-bold text-slate-900">Industry Relevant</h3>
          <p class="mt-2 text-sm text-slate-600">Built with real-world job skills in mind.</p>
        </div>

        <div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm hover:shadow-md transition">
          <div class="w-12 h-12 rounded-2xl bg-teal-50 flex items-center justify-center mb-4">
            <i class="fas fa-rocket text-xl text-teal-600"></i>
          </div>
          <h3 class="font-bold text-slate-900">Career Growth</h3>
          <p class="mt-2 text-sm text-slate-600">Discover what to learn next for your dream role.</p>
        </div>
      </div>
    </div>

  </div>
</section>

<!-- tiny utility for line-clamp (only if not already in your build) -->
<style>
  .line-clamp-2{
    display:-webkit-box;
    -webkit-line-clamp:2;
    -webkit-box-orient:vertical;
    overflow:hidden;
  }
</style>

{% endblock %}
