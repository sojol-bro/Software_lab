{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="relative min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-blue-100 overflow-hidden">

  <!-- Background Blobs -->
  <div class="absolute top-[-150px] left-[-150px] w-[400px] h-[400px] bg-blue-200 rounded-full opacity-30 blur-3xl animate-pulse"></div>
  <div class="absolute bottom-[-150px] right-[-150px] w-[400px] h-[400px] bg-pink-200 rounded-full opacity-30 blur-3xl animate-pulse"></div>

  <!-- Signup Card -->
  <div class="relative bg-white bg-opacity-90 backdrop-blur-xl shadow-2xl rounded-3xl w-full max-w-md p-10">
    <h2 class="text-center text-3xl font-extrabold text-gray-900 mb-8">
      Create your account
    </h2>

    <form id="signupForm" class="space-y-6" action="{% url 'signup' %}" method="POST" novalidate>
      {% csrf_token %}

      <!-- Username -->
      <div>
        <label for="username" class="block mb-1 text-sm font-medium text-gray-700">
          Username
        </label>
        <input id="username" name="username" type="text" required
               class="w-full px-4 py-3 border border-gray-300 rounded-2xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400 sm:text-sm transition-all"
               placeholder="Enter username"
               value="{{ form.username.value|default_if_none:'' }}">
        <p id="usernameError" class="mt-1 text-sm text-red-600 transition-opacity opacity-0"></p>
      </div>

      <!-- Email -->
      <div>
        <label for="email" class="block mb-1 text-sm font-medium text-gray-700">
          Email Address
        </label>
        <input id="email" name="email" type="email" required
               class="w-full px-4 py-3 border border-gray-300 rounded-2xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400 sm:text-sm transition-all"
               placeholder="Enter email address"
               value="{{ form.email.value|default_if_none:'' }}">
        <p id="emailError" class="mt-1 text-sm text-red-600 transition-opacity opacity-0"></p>
      </div>

      <!-- Account Type -->
      <div>
        <label for="user_type" class="block mb-1 text-sm font-medium text-gray-700">
          Account Type
        </label>
        <select id="user_type" name="user_type" required
                class="w-full px-4 py-3 border border-gray-300 rounded-2xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400 sm:text-sm transition-all">
          <option value="">Select Account Type</option>
          <option value="user" {% if form.user_type.value == 'user' %}selected{% endif %}>Regular User</option>
          <option value="employee" {% if form.user_type.value == 'employee' %}selected{% endif %}>Employee</option>
          <option value="admin" {% if form.user_type.value == 'admin' %}selected{% endif %}>Administrator</option>
        </select>
        <p id="userTypeError" class="mt-1 text-sm text-red-600 transition-opacity opacity-0"></p>
      </div>

      <!-- Password -->
      <div class="relative">
        <label for="password" class="block mb-1 text-sm font-medium text-gray-700">
          Password
        </label>
        <input id="password" name="password" type="password" required
               class="w-full px-4 py-3 border border-gray-300 rounded-2xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400 sm:text-sm transition-all"
               placeholder="Enter password">
        <button type="button" class="absolute right-3 top-10 text-gray-500 font-medium text-sm toggle-password" data-target="password">
          <i class="fas fa-eye"></i>
        </button>
        <p id="passwordError" class="mt-1 text-sm text-red-600 transition-opacity opacity-0"></p>
      </div>

      <!-- Confirm Password -->
      <div class="relative">
        <label for="confirm_password" class="block mb-1 text-sm font-medium text-gray-700">
          Confirm Password
        </label>
        <input id="confirm_password" name="confirm_password" type="password" required
               class="w-full px-4 py-3 border border-gray-300 rounded-2xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400 sm:text-sm transition-all"
               placeholder="Re-enter password">
        <button type="button" class="absolute right-3 top-10 text-gray-500 font-medium text-sm toggle-password" data-target="confirm_password">
          <i class="fas fa-eye"></i>
        </button>
        <p id="confirmPasswordError" class="mt-1 text-sm text-red-600 transition-opacity opacity-0"></p>
      </div>

      <!-- Terms -->
      <div class="flex items-center">
        <input id="terms" name="terms" type="checkbox" required
               class="h-4 w-4 text-blue-600 focus:ring-blue-400 border-gray-300 rounded transition-all">
        <label for="terms" class="ml-2 text-sm text-gray-700">
          I agree to the <a href="#" class="text-blue-600 hover:text-blue-500 font-medium">Terms and Conditions</a>
        </label>
        <p id="termsError" class="mt-1 text-sm text-red-600 transition-opacity opacity-0"></p>
      </div>

      <!-- Submit -->
      <div>
        <button type="submit"
                class="w-full flex justify-center py-2 px-4 rounded-2xl shadow-lg text-white font-semibold text-sm bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 transform hover:scale-105 transition-all focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-400">
          Create Account
        </button>
      </div>
    </form>

    <p class="mt-6 text-center text-sm text-gray-600">
      Already have an account?
      <a href="{% url 'login' %}" class="font-medium text-blue-600 hover:text-blue-500">Sign in</a>
    </p>

    <!-- Divider -->
    <div class="mt-6 relative">
      <div class="absolute inset-0 flex items-center">
        <div class="w-full border-t border-gray-300"></div>
      </div>
      <div class="relative flex justify-center text-sm">
        <span class="px-2 bg-white text-gray-500">
          Or sign up with
        </span>
      </div>
    </div>

    <!-- Social -->
    <div class="mt-6 grid grid-cols-3 gap-3">
      <a href="#" class="w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-2xl shadow-sm bg-white text-sm font-medium text-gray-500 hover:bg-blue-50 transition-all transform hover:scale-105">
        <i class="fab fa-facebook-f text-blue-600"></i>
      </a>
      <a href="#" class="w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-2xl shadow-sm bg-white text-sm font-medium text-gray-500 hover:bg-red-50 transition-all transform hover:scale-105">
        <i class="fab fa-google text-red-600"></i>
      </a>
      <a href="#" class="w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-2xl shadow-sm bg-white text-sm font-medium text-gray-500 hover:bg-blue-50 transition-all transform hover:scale-105">
        <i class="fab fa-linkedin-in text-blue-500"></i>
      </a>
    </div>
  </div>
</div>

<script>
  document.querySelectorAll('.toggle-password').forEach(btn => {
    btn.addEventListener('click', () => {
      const input = document.getElementById(btn.dataset.target);
      input.type = input.type === 'password' ? 'text' : 'password';
      btn.innerHTML = input.type === 'password'
        ? '<i class="fas fa-eye"></i>'
        : '<i class="fas fa-eye-slash"></i>';
    });
  });

  document.getElementById('signupForm').addEventListener('submit', function(e) {
    let valid = true;

    const clear = id => {
      const el = document.getElementById(id);
      if (el) { el.textContent = ''; el.style.opacity = '0'; }
    };

    ['usernameError','emailError','userTypeError','passwordError','confirmPasswordError','termsError'].forEach(clear);

    const username = usernameEl = document.getElementById('username').value.trim();
    if (!username) { usernameError.textContent = 'Username is required'; usernameError.style.opacity = '1'; valid = false; }

    const email = document.getElementById('email').value.trim();
    if (!email || !/^\S+@\S+\.\S+$/.test(email)) {
      emailError.textContent = 'Enter a valid email'; emailError.style.opacity = '1'; valid = false;
    }

    const userType = document.getElementById('user_type').value;
    if (!userType) { userTypeError.textContent = 'Select account type'; userTypeError.style.opacity = '1'; valid = false; }

    const password = document.getElementById('password').value;
    if (password.length < 6) { passwordError.textContent = 'Password must be at least 6 characters'; passwordError.style.opacity = '1'; valid = false; }

    const confirmPassword = document.getElementById('confirm_password').value;
    if (confirmPassword !== password) { confirmPasswordError.textContent = 'Passwords do not match'; confirmPasswordError.style.opacity = '1'; valid = false; }

    if (!document.getElementById('terms').checked) {
      termsError.textContent = 'You must agree to the terms'; termsError.style.opacity = '1'; valid = false;
    }

    if (!valid) e.preventDefault();
  });
</script>
{% endblock %}
