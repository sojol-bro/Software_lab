{% extends 'base-admin.html' %}
{% load static %}

{% block content_admin %}
<div class="min-h-screen bg-slate-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

    <!-- Header -->
    <div class="relative overflow-hidden rounded-3xl border border-slate-200 bg-white shadow-[0_18px_60px_rgba(15,23,42,0.08)]">
      <div class="pointer-events-none absolute inset-0">
        <div class="absolute -top-24 -right-24 h-72 w-72 rounded-full bg-blue-200/40 blur-3xl"></div>
        <div class="absolute -bottom-28 -left-24 h-80 w-80 rounded-full bg-indigo-200/35 blur-3xl"></div>
        <div class="absolute inset-0 bg-[radial-gradient(circle_at_20%_20%,rgba(59,130,246,0.10),transparent_55%),radial-gradient(circle_at_85%_30%,rgba(99,102,241,0.10),transparent_55%)]"></div>
      </div>

      <div class="relative px-5 sm:px-7 lg:px-8 py-6 sm:py-7">
        <div class="flex flex-col gap-4 lg:flex-row lg:items-start lg:justify-between">
          <div class="min-w-0">
            <div class="flex items-center gap-3">
              <div class="h-11 w-11 rounded-2xl bg-gradient-to-br from-blue-600 to-indigo-600 flex items-center justify-center shadow-md">
                <span class="text-white text-lg">ğŸ‘¥</span>
              </div>
              <div class="min-w-0">
                <h1 class="text-2xl sm:text-3xl font-extrabold tracking-tight text-slate-900 truncate">
                  User Management
                </h1>
                <p class="mt-1 text-sm text-slate-600">
                  View, filter, and manage SkillNet users
                </p>
              </div>
            </div>

            <!-- quick signals -->
            <div class="mt-4 flex flex-wrap items-center gap-2">
              <span class="inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white/70 px-3 py-1 text-xs font-extrabold text-slate-700">
                <span class="text-slate-500">Total:</span> {{ total_users|default:"0" }}
              </span>
              <span class="inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white/70 px-3 py-1 text-xs font-extrabold text-slate-700">
                <span class="text-slate-500">Active jobs:</span> {{ total_active_jobs|default:"0" }}
              </span>
              <span class="inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white/70 px-3 py-1 text-xs font-extrabold text-slate-700">
                <span class="text-slate-500">Courses:</span> {{ total_courses|default:"0" }}
              </span>
            </div>
          </div>

          <div class="flex flex-col sm:flex-row gap-2 sm:items-center">
            <button id="exportBtn"
              class="inline-flex items-center justify-center gap-2 rounded-2xl border border-slate-200 bg-white/80 px-4 py-2.5 text-sm font-extrabold text-slate-800 shadow-sm hover:shadow-md hover:bg-white transition focus:outline-none focus:ring-4 focus:ring-blue-100">
              <span id="exportIcon">ğŸ“¥</span>
              <span id="exportText">Export Data</span>
            </button>

            <a href="/admin_dashboard"
              class="inline-flex items-center justify-center gap-2 rounded-2xl bg-gradient-to-r from-blue-600 to-indigo-600 px-4 py-2.5 text-sm font-extrabold text-white shadow-md hover:shadow-lg transition focus:outline-none focus:ring-4 focus:ring-blue-200">
              <span>â¬…</span>
              <span>Back to Dashboard</span>
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="mt-6 sticky top-3 z-10">
      <div class="rounded-3xl border border-slate-200 bg-white/70 backdrop-blur shadow-sm p-2 overflow-x-auto">
        <div class="flex items-center gap-2 min-w-max">
          <a href="/admin_dashboard"
             class="inline-flex items-center gap-2 px-4 py-2 rounded-2xl text-sm font-bold text-slate-700 hover:bg-slate-100 transition">
            <span>ğŸ </span> Overview
          </a>
          <span
             class="inline-flex items-center gap-2 px-4 py-2 rounded-2xl text-sm font-extrabold bg-blue-50 text-blue-700 border border-blue-100">
            <span>ğŸ‘¥</span> Users
          </span>
          <a href="#"
             class="inline-flex items-center gap-2 px-4 py-2 rounded-2xl text-sm font-bold text-slate-700 hover:bg-slate-100 transition">
            <span>ğŸ“š</span> Content
          </a>
          <a href="#"
             class="inline-flex items-center gap-2 px-4 py-2 rounded-2xl text-sm font-bold text-slate-700 hover:bg-slate-100 transition">
            <span>ğŸ«</span> Support
          </a>
          <a href="#"
             class="inline-flex items-center gap-2 px-4 py-2 rounded-2xl text-sm font-bold text-slate-700 hover:bg-slate-100 transition">
            <span>ğŸ“ˆ</span> Analytics
          </a>
          <a href="#"
             class="inline-flex items-center gap-2 px-4 py-2 rounded-2xl text-sm font-bold text-slate-700 hover:bg-slate-100 transition">
            <span>âš™ï¸</span> Settings
          </a>
        </div>
      </div>
    </div>

    <!-- Stat Cards -->
    <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4">
      <div class="rounded-3xl border border-slate-200 bg-white shadow-sm hover:shadow-md transition p-4">
        <div class="flex items-center justify-between">
          <p class="text-xs font-extrabold text-slate-500">Total users</p>
          <div class="h-10 w-10 rounded-2xl bg-blue-50 flex items-center justify-center">ğŸ‘¤</div>
        </div>
        <div class="mt-3 flex items-end justify-between gap-3">
          <p class="text-2xl font-extrabold tracking-tight text-slate-900">{{ total_users|default:"0" }}</p>
          <span class="inline-flex items-center rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 text-xs font-extrabold text-emerald-700">â†‘ 12.3%</span>
        </div>
        <div class="mt-3 h-2.5 w-full rounded-full bg-slate-100 overflow-hidden">
          <div class="h-full rounded-full bg-gradient-to-r from-blue-600 to-indigo-600" style="width: 72%"></div>
        </div>
      </div>

      <div class="rounded-3xl border border-slate-200 bg-white shadow-sm hover:shadow-md transition p-4">
        <div class="flex items-center justify-between">
          <p class="text-xs font-extrabold text-slate-500">Active jobs</p>
          <div class="h-10 w-10 rounded-2xl bg-blue-50 flex items-center justify-center">ğŸ’¼</div>
        </div>
        <div class="mt-3 flex items-end justify-between gap-3">
          <p class="text-2xl font-extrabold tracking-tight text-slate-900">{{ total_active_jobs|default:"0" }}</p>
          <span class="inline-flex items-center rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 text-xs font-extrabold text-emerald-700">â†‘ 22.9%</span>
        </div>
        <div class="mt-3 h-2.5 w-full rounded-full bg-slate-100 overflow-hidden">
          <div class="h-full rounded-full bg-gradient-to-r from-blue-600 to-indigo-600" style="width: 64%"></div>
        </div>
      </div>

      <div class="rounded-3xl border border-slate-200 bg-white shadow-sm hover:shadow-md transition p-4">
        <div class="flex items-center justify-between">
          <p class="text-xs font-extrabold text-slate-500">Total courses</p>
          <div class="h-10 w-10 rounded-2xl bg-blue-50 flex items-center justify-center">ğŸ“š</div>
        </div>
        <div class="mt-3 flex items-end justify-between gap-3">
          <p class="text-2xl font-extrabold tracking-tight text-slate-900">{{ total_courses|default:"0" }}</p>
          <span class="inline-flex items-center rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 text-xs font-extrabold text-emerald-700">â†‘ 17.5%</span>
        </div>
        <div class="mt-3 h-2.5 w-full rounded-full bg-slate-100 overflow-hidden">
          <div class="h-full rounded-full bg-gradient-to-r from-blue-600 to-indigo-600" style="width: 58%"></div>
        </div>
      </div>

      <div class="rounded-3xl border border-slate-200 bg-white shadow-sm hover:shadow-md transition p-4">
        <div class="flex items-center justify-between">
          <p class="text-xs font-extrabold text-slate-500">Total revenue</p>
          <div class="h-10 w-10 rounded-2xl bg-blue-50 flex items-center justify-center">ğŸ’°</div>
        </div>
        <div class="mt-3 flex items-end justify-between gap-3">
          <p class="text-2xl font-extrabold tracking-tight text-slate-900">178k</p>
          <span class="inline-flex items-center rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 text-xs font-extrabold text-emerald-700">â†‘ 35.8%</span>
        </div>
        <div class="mt-3 h-2.5 w-full rounded-full bg-slate-100 overflow-hidden">
          <div class="h-full rounded-full bg-gradient-to-r from-blue-600 to-indigo-600" style="width: 76%"></div>
        </div>
      </div>

      <div class="rounded-3xl border border-slate-200 bg-white shadow-sm hover:shadow-md transition p-4">
        <div class="flex items-center justify-between">
          <p class="text-xs font-extrabold text-slate-500">Conversion rate</p>
          <div class="h-10 w-10 rounded-2xl bg-blue-50 flex items-center justify-center">ğŸ“ˆ</div>
        </div>
        <div class="mt-3 flex items-end justify-between gap-3">
          <p class="text-2xl font-extrabold tracking-tight text-slate-900">12.4%</p>
          <span class="inline-flex items-center rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 text-xs font-extrabold text-emerald-700">â†‘ 12.3%</span>
        </div>
        <div class="mt-3 h-2.5 w-full rounded-full bg-slate-100 overflow-hidden">
          <div class="h-full rounded-full bg-gradient-to-r from-blue-600 to-indigo-600" style="width: 44%"></div>
        </div>
      </div>

      <div class="rounded-3xl border border-slate-200 bg-white shadow-sm hover:shadow-md transition p-4">
        <div class="flex items-center justify-between">
          <p class="text-xs font-extrabold text-slate-500">Avg rating</p>
          <div class="h-10 w-10 rounded-2xl bg-blue-50 flex items-center justify-center">â­</div>
        </div>
        <div class="mt-3 flex items-end justify-between gap-3">
          <p class="text-2xl font-extrabold tracking-tight text-slate-900">4.8</p>
          <span class="inline-flex items-center rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 text-xs font-extrabold text-emerald-700">â†‘ 0.3%</span>
        </div>
        <div class="mt-3 h-2.5 w-full rounded-full bg-slate-100 overflow-hidden">
          <div class="h-full rounded-full bg-gradient-to-r from-blue-600 to-indigo-600" style="width: 86%"></div>
        </div>
      </div>
    </div>

    <!-- User Management -->
    <div class="mt-6 rounded-3xl border border-slate-200 bg-white shadow-sm overflow-hidden">
      <div class="px-5 sm:px-7 py-5 border-b border-slate-200 bg-gradient-to-b from-white to-slate-50">
        <div class="flex flex-col gap-4 lg:flex-row lg:items-end lg:justify-between">
          <div>
            <h3 class="text-base font-extrabold tracking-tight text-slate-900">Users</h3>
            <p class="mt-1 text-sm text-slate-600">Search, filter, view and manage user accounts</p>
          </div>

          <!-- Search + filter -->
          <div class="flex flex-col sm:flex-row gap-2 sm:items-center w-full lg:w-auto">
            <div class="relative w-full sm:w-80">
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">âŒ•</span>
              <input id="searchInput" type="text" placeholder="Search by username or email..."
                class="w-full rounded-2xl border border-slate-200 bg-white px-10 py-2.5 text-sm font-semibold text-slate-800 placeholder:text-slate-400 shadow-sm focus:outline-none focus:ring-4 focus:ring-blue-100" />
            </div>

            <select id="filterSelect"
              class="w-full sm:w-44 rounded-2xl border border-slate-200 bg-white px-3 py-2.5 text-sm font-bold text-slate-800 shadow-sm focus:outline-none focus:ring-4 focus:ring-blue-100">
              <option value="all">All</option>
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
              <option value="candidate">Candidates</option>
              <option value="employer">Employers</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Table -->
      <div class="overflow-x-auto">
        <table class="min-w-full">
          <thead class="bg-slate-50">
            <tr class="text-left">
              <th class="px-5 sm:px-7 py-4 text-xs font-extrabold uppercase tracking-wider text-slate-500">User</th>
              <th class="px-5 sm:px-7 py-4 text-xs font-extrabold uppercase tracking-wider text-slate-500">Type</th>
              <th class="px-5 sm:px-7 py-4 text-xs font-extrabold uppercase tracking-wider text-slate-500">Join date</th>
              <th class="px-5 sm:px-7 py-4 text-xs font-extrabold uppercase tracking-wider text-slate-500">Status</th>
              <th class="px-5 sm:px-7 py-4 text-xs font-extrabold uppercase tracking-wider text-slate-500">Actions</th>
            </tr>
          </thead>

          <tbody class="divide-y divide-slate-100" id="userTbody">
            {% for u in recent_users %}
            <tr class="hover:bg-slate-50/70 transition user-row"
                data-username="{{ u.user.username|default:''|lower }}"
                data-email="{{ u.user.email|default:''|lower }}"
                data-status="{% if u.user.is_active %}active{% else %}inactive{% endif %}"
                data-type="{{ u.get_user_type_display|default:''|lower }}">
              <!-- User -->
              <td class="px-5 sm:px-7 py-4">
                <div class="flex items-center gap-3 min-w-0">
                  <!-- Avatar -->
                  <div class="relative shrink-0">
                    {% if u.profile_photo %}
                      <img src="{{ u.profile_photo.url }}" alt="{{ u.user.username }}"
                           class="h-11 w-11 rounded-2xl object-cover border border-slate-200" />
                    {% else %}
                      <div class="h-11 w-11 rounded-2xl bg-gradient-to-br from-blue-600 to-indigo-600 text-white flex items-center justify-center font-black shadow-sm">
                        {{ u.user.username|default:"U"|slice:":1"|upper }}
                      </div>
                    {% endif %}
                    <span class="absolute -bottom-1 -right-1 h-4 w-4 rounded-full border-2 border-white {% if u.user.is_active %}bg-emerald-500{% else %}bg-slate-400{% endif %}"></span>
                  </div>

                  <div class="min-w-0">
                    <div class="font-extrabold text-slate-900 truncate max-w-[16rem] sm:max-w-[22rem]">
                      {{ u.user.username }}
                    </div>
                    <div class="text-sm text-slate-600 truncate max-w-[16rem] sm:max-w-[22rem]">
                      {{ u.user.email|default:"No email" }}
                    </div>
                  </div>
                </div>
              </td>

              <!-- Type -->
              <td class="px-5 sm:px-7 py-4">
                <span class="inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-3 py-1 text-xs font-extrabold text-slate-700">
                  {{ u.get_user_type_display }}
                </span>
              </td>

              <!-- Date -->
              <td class="px-5 sm:px-7 py-4 text-sm font-semibold text-slate-700">
                {{ u.created_at|date:"d-m-Y" }}
              </td>

              <!-- Status -->
              <td class="px-5 sm:px-7 py-4">
                {% if u.user.is_active %}
                  <button type="button"
                    class="status-btn inline-flex items-center justify-center gap-2 rounded-full border border-emerald-200 bg-emerald-50 px-3 py-1 text-xs font-black text-emerald-700 hover:bg-emerald-100 transition focus:outline-none focus:ring-4 focus:ring-emerald-100"
                    data-status="active">
                    <span class="h-2 w-2 rounded-full bg-emerald-500"></span> Active
                  </button>
                {% else %}
                  <button type="button"
                    class="status-btn inline-flex items-center justify-center gap-2 rounded-full border border-rose-200 bg-rose-50 px-3 py-1 text-xs font-black text-rose-700 hover:bg-rose-100 transition focus:outline-none focus:ring-4 focus:ring-rose-100"
                    data-status="inactive">
                    <span class="h-2 w-2 rounded-full bg-rose-500"></span> Inactive
                  </button>
                {% endif %}
              </td>

              <!-- Actions (UI only) -->
              <td class="px-5 sm:px-7 py-4">
                <div class="flex items-center gap-2">
                  <button type="button"
                    class="inline-flex items-center justify-center h-10 w-10 rounded-2xl border border-slate-200 bg-white hover:bg-slate-50 transition focus:outline-none focus:ring-4 focus:ring-blue-100"
                    title="View Profile" aria-label="View Profile">
                    ğŸ‘ï¸
                  </button>

                  <button type="button"
                    class="inline-flex items-center justify-center h-10 w-10 rounded-2xl border border-slate-200 bg-white hover:bg-slate-50 transition focus:outline-none focus:ring-4 focus:ring-blue-100"
                    title="Delete User" aria-label="Delete User">
                    ğŸ—‘ï¸
                  </button>
                </div>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="5" class="px-5 sm:px-7 py-10">
                <div class="rounded-2xl border border-dashed border-slate-200 bg-slate-50 p-10 text-center">
                  <div class="text-3xl">ğŸ‘¤</div>
                  <p class="mt-3 font-extrabold text-slate-900">No users found</p>
                  <p class="mt-1 text-sm text-slate-600">Users will appear here once they register.</p>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Footer row -->
      <div class="px-5 sm:px-7 py-4 border-t border-slate-200 bg-white flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2">
        <p class="text-xs text-slate-500">
          Tip: Use search + filter to quickly find users.
        </p>
        <p class="text-xs font-bold text-slate-600" id="resultCount"></p>
      </div>
    </div>

    <!-- Page footer -->
    <div class="mt-8 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 text-xs text-slate-500">
      <span>Â© {{ now|date:"Y" }} SkillNet Admin</span>
      <span class="inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white px-3 py-1 text-xs font-extrabold text-slate-700">
        <span class="h-2 w-2 rounded-full bg-emerald-500"></span> System status: OK
      </span>
    </div>

  </div>
</div>

<script>
  // --- Export button micro-interaction (UI only) ---
  (function () {
    const btn = document.getElementById('exportBtn');
    if (!btn) return;
    const icon = document.getElementById('exportIcon');
    const text = document.getElementById('exportText');

    btn.addEventListener('click', () => {
      icon.textContent = 'âœ…';
      text.textContent = 'Exported!';
      btn.classList.add('opacity-90');
      setTimeout(() => {
        icon.textContent = 'ğŸ“¥';
        text.textContent = 'Export Data';
        btn.classList.remove('opacity-90');
      }, 1600);
    });
  })();

  // --- Search + Filter (client-side UI filtering) ---
  (function () {
    const searchInput = document.getElementById('searchInput');
    const filterSelect = document.getElementById('filterSelect');
    const tbody = document.getElementById('userTbody');
    const resultCount = document.getElementById('resultCount');
    if (!tbody) return;

    const rows = Array.from(tbody.querySelectorAll('.user-row'));

    function normalizeType(t) {
      // map display types to stable keys for filtering
      // If your display values are exactly "Candidate"/"Employer" this will work.
      // Otherwise tweak these mappings.
      if (!t) return '';
      if (t.includes('candidate')) return 'candidate';
      if (t.includes('employer')) return 'employer';
      return t;
    }

    function applyFilters() {
      const q = (searchInput?.value || '').trim().toLowerCase();
      const f = (filterSelect?.value || 'all').toLowerCase();

      let visible = 0;

      rows.forEach(row => {
        const username = row.dataset.username || '';
        const email = row.dataset.email || '';
        const status = row.dataset.status || '';
        const type = normalizeType(row.dataset.type || '');

        const matchesSearch = !q || username.includes(q) || email.includes(q);
        const matchesFilter =
          f === 'all' ||
          (f === 'active' && status === 'active') ||
          (f === 'inactive' && status === 'inactive') ||
          (f === 'candidate' && type.includes('candidate')) ||
          (f === 'employer' && type.includes('employer'));

        const show = matchesSearch && matchesFilter;
        row.classList.toggle('hidden', !show);
        if (show) visible++;
      });

      if (resultCount) {
        resultCount.textContent = visible + ' result' + (visible === 1 ? '' : 's');
      }
    }

    searchInput?.addEventListener('input', applyFilters);
    filterSelect?.addEventListener('change', applyFilters);
    applyFilters();
  })();

  // --- Status toggle (UI only; does NOT change DB) ---
  (function () {
    document.querySelectorAll('.status-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const current = btn.getAttribute('data-status');
        const row = btn.closest('tr');
        if (!row) return;

        if (current === 'active') {
          btn.setAttribute('data-status', 'inactive');
          row.dataset.status = 'inactive';
          btn.className =
            "status-btn inline-flex items-center justify-center gap-2 rounded-full border border-rose-200 bg-rose-50 px-3 py-1 text-xs font-black text-rose-700 hover:bg-rose-100 transition focus:outline-none focus:ring-4 focus:ring-rose-100";
          btn.innerHTML = '<span class="h-2 w-2 rounded-full bg-rose-500"></span> Inactive';
        } else {
          btn.setAttribute('data-status', 'active');
          row.dataset.status = 'active';
          btn.className =
            "status-btn inline-flex items-center justify-center gap-2 rounded-full border border-emerald-200 bg-emerald-50 px-3 py-1 text-xs font-black text-emerald-700 hover:bg-emerald-100 transition focus:outline-none focus:ring-4 focus:ring-emerald-100";
          btn.innerHTML = '<span class="h-2 w-2 rounded-full bg-emerald-500"></span> Active';
        }
      });
    });
  })();
</script>

{% endblock %}
